<html>
<head>
  <title>Media API: Exercise 4 - update video tags</title>
		<style type="text/css">
			body {font-family : Helvetica,Arial,sans-serif; color : #619FA8;}
			legend { color: #CF0050; }
		</style>
		<!-- Javascript Media API wrapper from opensource.brightcove.com -->
		<script type="text/javascript" src="http://files.brightcove.com/bc-mapi.js"></script>
		
</head>
<!-- do the video info retrieval when the document loads -->
<body>
  <!-- Read method script -->
  		<script type="text/javascript">
			// BCL Media API search maker -- adapted from JS-MAPI on opensource.brightcove.com
			// namespace to keep all the "global" vars together
			var BCL = {};
			// approved tags as an array
			BCL.approvedTags = ["animal","bird","fish","mammal","sea","land","air","training"];
			BCMAPI.callback = "BCL.onSearchResponse";
			BCL.url = "http://api.brightcove.com/services/library";
			BCL.command = "search_videos";
			BCL.params = {};
			BCL.srcValue = "";
			/**
			 * Injects API calls into the head of a document
			 */
			BCL.injectScript = function (accountID) {
				var scriptElement = document.createElement("script");
				switch (accountID) {
				case 921483702001:
				BCL.readToken = "WDGO_XdKqXUpy8fzD41MKA8kAhQRAmdux8cu8LNhRzAywCnuBpgV_A..";
				BCL.writeToken = "Jyiei-T0_tDMwct8bUns819VTkfvkt9iX2mnIfkc8GNnREmW2YTG6A..";
				break;
				BCL.readToken = "w8DSqB3RP9c2gP-3trkpmdydleJzENrYV7oX3hqey0Sxs1dAK4emJA..";
				BCL.writeToken = "4VlUxmXGukFzhTBi2GdxGYVUb36y-uVY8VVlR3Knnti2BHvaw2WkxQ..";
				break;
				BCL.readToken = "jskS1rEtQHybQGcuATa1ANGOYjfV2cnmDDnOKoFxnfpyGk59SPILLA..";
				BCL.writeToken = "uikR5D2s7F-ODnXFRV6u7riQIDiHtsDNXRWsLS_mHltMKRMWr6mmYg..";
				break;
				default:
				alert("Please select an account!");
				}
				BCL.srcValue = BCL.url + "?command=" + BCL.command + "&token=" + BCL.readToken + "&callback=" + BCMAPI.callback;
				for (var param in BCL.params) {
					BCL.srcValue += "&" + param + "=" + BCL.params[param];
				}
				scriptElement.setAttribute("src", BCL.srcValue);
				scriptElement.setAttribute("type", "text/javascript");
				document.getElementsByTagName("head")[0].appendChild(scriptElement);
			};
			BCL.onSearchResponse = function(jsonData) {
				  var html = "<select id='videolist' onChange='BCL.onVideoSelect(this.options.selectedIndex)'>";
					var video;
				  // populate the tag list
					BCL.items = jsonData.items;
				  for (var i in jsonData.items) {
				    video = jsonData.items[i];
				    html += "<option value='" + video.id + "'>" + video.name + "</option>";
				  }
				  document.getElementById("videoSelector").innerHTML = html;
				  // populate the form
				  BCL.onVideoSelect(0);
			}
			BCL.onVideoSelect = function(index) {
				var video = BCL.items[index];
				document.getElementById("id").value = video.id;
				document.getElementById("tags").value = video.tags;
				document.getElementById("name").value = video.name;

			}
			// code to move tags from master tag list to video tag list
			 BCL.move = function(fbox, tbox) {
				var arrFbox = new Array();
				var arrTbox = new Array();
				var arrLookup = new Array();
				var i;
				for (i = 0; i < tbox.options.length; i++) {
				arrLookup[tbox.options[i].text] = tbox.options[i].value;
				arrTbox[i] = tbox.options[i].text;
				}
				var fLength = 0;
				var tLength = arrTbox.length;
				for(i = 0; i < fbox.options.length; i++) {
				arrLookup[fbox.options[i].text] = fbox.options[i].value;
				if (fbox.options[i].selected && fbox.options[i].value != "") {
				arrTbox[tLength] = fbox.options[i].text;
				tLength++;
				}
				else {
				arrFbox[fLength] = fbox.options[i].text;
				fLength++;
				   }
				}
				arrFbox.sort();
				arrTbox.sort();
				fbox.length = 0;
				tbox.length = 0;
				var c;
				for(c = 0; c < arrFbox.length; c++) {
				var no = new Option();
				no.value = arrLookup[arrFbox[c]];
				no.text = arrFbox[c];
				fbox[c] = no;
				}
				for(c = 0; c < arrTbox.length; c++) {
				var no = new Option();
				no.value = arrLookup[arrTbox[c]];
				no.text = arrTbox[c];
				tbox[c] = no;
				   }
				}

		</script>

  <!-- Write method script -->
  <script type="text/javascript">

	  function doUpdateVideo(){
	       form = document.getElementById("update_video_sample");
	       buildJSONRequest();
	       form.action = "http://api.brightcove.com/services/post";
	       form.submit();
	  }


	  function buildJSONRequest(){
	       if (document.getElementById('shortDescription').value =="") {
	               alert("Please enter a short description");
	               return;
	       }
	       else {
	               json = document.getElementById('JSONView');
	               // construct object for JSON RPC
	               var updateData = {};
	               updateData.method = "update_video";
	               updateData.params = {};
	               updateData.params.video = {};
	               updateData.params.video.id = document.getElementById("id").value;
	               updateData.params.video.shortDescription = document.getElementById("tags").value;
	               updateData.params.token = BCL.writeToken;
	               
	               //Construct the JSON request:
	               json.value = JSON.stringify(updateData);
	       }
	  }
  </script>

  <div style="font-weight:bold;font-size:24">
    Media API Exercise: Update a Video
		<fieldset>
      <legend>Select the Account</legend>
			<div id="accountSet">
			<!-- I'm using the account IDs as values - doesn't matter what you use -->
			<select id="accountSelect" onchange="BCL.injectScript(this.options[this.selectedIndex].value)">
				<option>Choose an Account</option>
				<option value="921483702001">Developer Training</option>
				<option value="835233035001">Mobile Training</option>
				<option value="57838016001">Brightcove Learning</option>
			</select>

  </div>
  <p>Select the video to update</p>
  <div id="videoSelector"></div>
	<br/><br/>
	<form name="combo_box">
<table><tr><td>
<select multiple size="10" name="list1" style="width:150">
<option value="12">Alabama</option>
<option value="54">Alaska</option>
<option value="65">Arizona</option>
<option value="45">Arkansas</option>
<option value="2">California</option>
<option value="6">Colorado</option>
<option value="81">Connecticut</option>
<option value="5">Delaware</option>
<option value="23">District of Columbia</option>
<option value="58">Florida</option>
<option value="87">Georgia</option>
<option value="98">Hawaii</option>
<option value="53">Idaho</option>
<option value="22">Illinois</option>
<option value="28">Indiana</option>
<option value="89">Iowa</option>
<option value="71">Kansas</option>
<option value="35">Kentucky</option>
<option value="85">Louisiana</option>
<option value="9">Maine</option>
<option value="7">Maryland</option>
<option value="77">Massachusetts</option>
<option value="36">Michigan</option>
<option value="87">Minnesota</option>
<option value="66">Mississippi</option>
<option value="34">Missouri</option>
<option value="50">Montana</option>
<option value="20">Nebraska</option>
<option value="25">Nevada</option>
<option value="32">New Hampshire</option>
<option value="27">New Jersey</option>
<option value="74">New Mexico</option>
<option value="17">New York</option>
<option value="3">North Carolina</option>
<option value="13">North Dakota</option>
<option value="4">Ohio</option>
<option value="21">Oklahoma</option>
<option value="12">Oregon</option>
<option value="48">Pennsylvania</option>
<option value="63">Rhode Island</option>
<option value="82">South Carolina</option>
<option value="14">South Dakota</option>
<option value="72">Tennessee</option>
<option value="49">Texas</option>
<option value="47">Utah</option>
<option value="92">Vermont</option>
<option value="59">Virginia</option>
<option value="52">Washington</option>
<option value="41">West Virginia</option>
<option value="46">Wisconsin</option>
<option value="95">Wyoming</option>
</select>
</td>
<td align="center" valign="middle">
<input type="button" onClick="move(this.form.list2,this.form.list1)" value="<<">
<input type="button" onClick="move(this.form.list1,this.form.list2)" value=">>">
</td>
<td>
<select multiple size="10" name="list2" style="width:150">
</select>
</td></tr></table>
</form>

  <table>
    <tr>
      <td style="width:30%">API Location:</td>

      <td><input id="yourAPILocation" value="http://api.brightcove.com/services/post" size="45"></td>
    </tr>

    <tr>
      <td style="width:30%">Read Token:</td>

      <td><input id="yourReadToken" value="WDGO_XdKqXVJRVGtrNuGLxCYDNoR-SvA5yUqX2eE6KjgefOxRzQilw.." size="45"></td>
    </tr>

    <tr>
      <td style="width:30%">Write Token:</td>

      <td><input id="yourWriteToken" value="Jyiei-T0_tDMwct8bUns819VTkfvkt9iX2mnIfkc8GNnREmW2YTG6A.." size="45"></td>
    </tr>
    <tr>
      <td style="width:30%">Video ID (read-only):</td>

      <td style="width:100%"><input id="id" type="text" readonly="true" value=""></td>
    </tr>
    <tr>
      <td style="width:30%">Video Name (read-only):</td>

      <td style="width:100%"><input id="name" type="text" readonly="true" value=""></td>
    </tr>

    <tr>
      <td>Short Description</td>

      <td><input id="shortDescription" type="text" size="100" maxlength="250"></td>
    </tr>
  </table><br>
  <button onclick="doUpdateVideo()">Update Video</button>
	<!-- Note the form attributes! -->
  <form id="update_video_sample" method="post" enctype="multipart/form-data" target="postFrame" name="update_video_sample">
    <br>
		<!-- What's below is for debugging! -->
    <fieldset>
      <legend>JSON Request</legend> <input name="JSONView" id="JSONView" style="width:100%;border:none">
    </fieldset><br>
  </form><br>
  <br>

  <fieldset>
    <legend>Response:</legend> <iframe id="postFrame" name="postFrame" style="width:100%;border:none"></iframe>
  </fieldset><br>
</body>
</html>
